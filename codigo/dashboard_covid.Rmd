---
title: "COVID-19 Óbitos"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    horizontal_layout: fill
    navbar:
      - { title: "Sobre", href: "https://example.com/about" }
    source_code: "https://github.com/DaInLab/PPGMiT-openDataSUS.git"
runtime: shyni    
---
<style type="text/css">
.value-box .value {
    color: white;
}
.value-box .caption {
    color: white;
    font: 10;
}
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set("'D:/GoogleDrive/Mestrado/PPGMiT-openDataSUS'") 

# Diretorio da Trabalho
setwd('D:/GoogleDrive/Mestrado/PPGMiT-openDataSUS')

# Carregando as bibliotecas necessárias
if (!("ggplot2") %in% installed.packages()) install.packages("ggplot2")   
if (!("dplyr") %in% installed.packages()) install.packages("dplyr")
if (!("readr") %in% installed.packages()) install.packages("readr")
if (!("geobr") %in% installed.packages()) install.packages("geobr")
if (!("scales") %in% installed.packages()) install.packages("scales")
if (!("ggspatial") %in% installed.packages()) install.packages("ggspatial")
if (!("kableExtra") %in% installed.packages()) install.packages("kableExtra")
if (!("knitr") %in% installed.packages()) install.packages("knitr")

library(ggplot2) # Visualizacao dos dados
library(dplyr)   # Preparacao de dados
library(readr)   # Importacao dos dados
library(geobr)   # Mapa do Brasil
library(scales)
library(ggspatial)
library(flexdashboard)
library(knitr)
library(kableExtra)

# Importacao do arquivo : covid.csv
df_covid<- read.csv('D:/GoogleDrive/Mestrado/PPGMiT-openDataSUS/dados/covid.csv', sep=";")

# Dataframe : df_covid_2021
df_covid_2021 <- df_covid %>% filter(ANO_EVOLUCA == "2021")
# Dataframe : df_covid_2022
df_covid_2022 <- df_covid %>% filter(ANO_EVOLUCA == "2022")
# Dataframe : df_covid_2023
df_covid_2023 <- df_covid %>% filter(ANO_EVOLUCA == "2023")

# Numero Notificacoes 
num_notificacoes <- as.numeric(count(df_covid))
df_notificacoes_ano <- aggregate(df_covid$ANO_NOTIFIC,by=list(df_covid$ANO_NOTIFIC), FUN=length)
df_notificacoes_ano <- setNames(df_notificacoes_ano, c("Ano", "Qtde"))

# 2021
num_notificacoes_2021 <- as.numeric(df_notificacoes_ano$Qtde[df_notificacoes_ano$Ano == '2021'])
# 2022
num_notificacoes_2022 <- as.numeric(df_notificacoes_ano$Qtde[df_notificacoes_ano$Ano == '2022'])
# 2023
num_notificacoes_2023 <- as.numeric(df_notificacoes_ano$Qtde[df_notificacoes_ano$Ano == '2023'])

# Importacao do arquivo : covid_obitos.csv
df_obitos<- read.csv('D:/GoogleDrive/Mestrado/PPGMiT-openDataSUS/dados/covid_obitos.csv', sep=";")

# Dataframe : df_obitos_2021
df_obitos_2021 <- df_obitos %>% filter(ANO_EVOLUCA == "2021")
# Dataframe : df_obitos_2022
df_obitos_2022 <- df_obitos %>% filter(ANO_EVOLUCA == "2022")
# Dataframe : df_obitos_2023
df_obitos_2023 <- df_obitos %>% filter(ANO_EVOLUCA == "2023")

# Numero Obitos
num_obitos <- as.numeric(count(df_obitos))
num_obitos_2021 <- as.numeric(count(df_obitos_2021))
num_obitos_2022 <- as.numeric(count(df_obitos_2022))
num_obitos_2023 <- as.numeric(count(df_obitos_2023))

# Media Idade Obitos
media_idade_obitos <- round(mean(df_obitos$NU_IDADE_N),1)
media_idade_obitos_2021 <- round(mean(df_obitos_2021$NU_IDADE_N),1)
media_idade_obitos_2022 <- round(mean(df_obitos_2022$NU_IDADE_N),1)
media_idade_obitos_2023 <- round(mean(df_obitos_2023$NU_IDADE_N),1)


# Sexo
df_obitos_sexo <- as.data.frame(table(df_obitos$CS_SEXO)) %>% arrange(desc(Freq))
df_obitos_sexo <- setNames(df_obitos_sexo, c("Sexo", "Qtde"))
df_obitos_sexo['Label'] <- ifelse(df_obitos_sexo$Sexo == "M", "Masculino",ifelse(df_obitos_sexo$Sexo == "F", "Feminino", "Indefinido" ))
df_obitos_sexo['Percentual'] <- round(df_obitos_sexo$Qtde / sum(df_obitos_sexo$Qtde) * 100,1)

# Escolaridade
df_obitos_escol <- as.data.frame(table(df_obitos$CS_ESCOL_N)) %>% arrange(desc(Freq))
df_obitos_escol <- setNames(df_obitos_escol, c("Escolaridade", "Qtde"))
df_obitos_escol['Label'] <- ifelse(df_obitos_escol$Escolaridade == 0, "Sem Escolaridade",
                                  ifelse(df_obitos_escol$Escolaridade == 1, "Ensino Fundamental (1o Ciclo)", 
                                  ifelse(df_obitos_escol$Escolaridade == 2, "Ensino Fundamental (2o Ciclo)",
                                  ifelse(df_obitos_escol$Escolaridade == 3, "Ensino Médio",
                                  ifelse(df_obitos_escol$Escolaridade == 4, "Ensino Superior", "Ignorado")))))
df_obitos_escol['Percentual'] <- round(df_obitos_escol$Qtde / sum(df_obitos_escol$Qtde) * 100,1)


```

Visão Geral
===

Column {data-height=200; data-width=180}
------

### Numero Notificações COVID-19 {.no-title}

```{r}


valueBox(format(num_notificacoes, big.mark = ".") , caption = "Notificações COVID-19", color="black")


```


### Numero Notificações COVID-19 {.no-title}

```{r}

df_notificacoes_ano %>%
  kable("html", escape = F) %>%
  kable_styling("striped", full_width = F)

```




Column {data-height=200; data-width=250}
------

### {.no-title}

```{r}
valueBox(format(num_obitos, big.mark = "."), caption = "Numero Óbitos", color="red")

```

### {.no-title}

```{r}
valueBox(paste(media_idade_obitos, ' anos'), caption = "Média Idade Óbitos", color="blue")

```

### {.no-title}

```{r}
valueBox(df_obitos_sexo$Label[1], caption = "Sexo", color="gray")

```

### {.no-title}

```{r}
valueBox(df_obitos_escol$Label[1], caption = "Escolaridade", color="gray")

```

2021
===

Column {data-height=200; data-width=180}
------

### Numero Notificações {.no-title}

```{r}
valueBox(format(num_notificacoes_2021, big.mark = ".") , caption = "Notificações COVID-19", color="black")

```


### Obitos {.no-title}

```{r}
gauge(55, min = 0, max = 100, symbol = '%', label="Obitos %", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Óbitos Outras Doenças {.no-title}

```{r}
gauge(13, min = 0, max = 100, symbol = '%', label="Óbitos Outras Doenças",gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Cura {.no-title}

```{r}
gauge(30, min = 0, max = 100, symbol = '%', label="Cura %", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```


### Sem Informação {.no-title}

```{r}
gauge(2, min = 0, max = 100, symbol = '%', label= "Sem Informação", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

Column {.tabset}
---
### Mapa Óbitos Brasil

```{r}

```

### Fatores de Risco 

```{r}

```

### Sinais e Sintomas

```{r}

```

### Idade

```{r}

```

### Sexo

```{r}

```

### Escolaridade

```{r}

```


Column {data-height=200; data-width=250}
------

### {.no-title}

```{r}
valueBox(format(num_obitos_2021, big.mark = "."), caption = "Numero Óbitos", color="red")

```
### {.no-title}

```{r}
valueBox(paste(media_idade_obitos_2021, ' anos'), caption = "Média Idade Óbitos", color="blue")

```

### {.no-title}

```{r}
valueBox('Diabetes Mellitus', caption = "Principal Fator de Risco - Óbitos", color="brown")

```


### {.no-title}

```{r}
valueBox('Dor de Garganta', caption = "Principal Sinal ou Sintoma - Óbitos", color="orange")

```


### {.no-title}

```{r}
valueBox('Masculino', caption = "Sexo", color="gray")

```

### {.no-title}

```{r}
valueBox('Superior', caption = "Escolaridade", color="gray")

```

2022
===

Column {data-height=200; data-width=180}
------

### Numero Notificações {.no-title}

```{r}
valueBox(format(num_notificacoes_2022, big.mark = ".") , caption = "Notificações COVID-19", color="black")

```


### Obitos {.no-title}

```{r}
gauge(55, min = 0, max = 100, symbol = '%', label="Obitos %", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Óbitos Outras Doenças {.no-title}

```{r}
gauge(13, min = 0, max = 100, symbol = '%', label="Óbitos Outras Doenças",gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Cura {.no-title}

```{r}
gauge(30, min = 0, max = 100, symbol = '%', label="Cura %", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```


### Sem Informação {.no-title}

```{r}
gauge(2, min = 0, max = 100, symbol = '%', label= "Sem Informação", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

Column {.tabset}
---
### Mapa Óbitos Brasil

```{r}

```

### Fatores de Risco 

```{r}

```

### Sinais e Sintomas

```{r}

```

### Idade

```{r}

```

### Sexo

```{r}

```

### Escolaridade

```{r}

```


Column {data-height=200; data-width=250}
------

### {.no-title}

```{r}
valueBox(valueBox(format(num_obitos_2022, big.mark = "."), caption = "Numero Óbitos", color="red"), caption = "Numero Óbitos", color="red")

```

### {.no-title}

```{r}
valueBox(paste(media_idade_obitos_2022, ' anos'), caption = "Média Idade Óbitos", color="blue")

```

### {.no-title}

```{r}
valueBox('Diabetes Mellitus', caption = "Principal Fator de Risco - Óbitos", color="brown")

```

### {.no-title}

```{r}
valueBox('Dor de Garganta', caption = "Principal Sinal ou Sintoma - Óbitos", color="orange")

```

### {.no-title}

```{r}
valueBox('Masculino', caption = "Sexo", color="gray")

```

### {.no-title}

```{r}
valueBox('Superior', caption = "Escolaridade", color="gray")

```


2023
===

Column {data-height=200; data-width=180}
------

### Numero Notificações {.no-title}

```{r}
valueBox(format(num_notificacoes_2023, big.mark = ".") , caption = "Notificações COVID-19", color="black")

```

### Obitos {.no-title}

```{r}
gauge(55, min = 0, max = 100, symbol = '%', label="Obitos %", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Óbitos Outras Doenças {.no-title}

```{r}
gauge(13, min = 0, max = 100, symbol = '%', label="Óbitos Outras Doenças",gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Cura {.no-title}

```{r}
gauge(30, min = 0, max = 100, symbol = '%', label="Cura %", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```


### Sem Informação {.no-title}

```{r}
gauge(2, min = 0, max = 100, symbol = '%', label= "Sem Informação", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

Column {.tabset}
---
### Mapa Óbitos Brasil

```{r}

```

### Fatores de Risco 

```{r}

```

### Sinais e Sintomas

```{r}

```

### Idade

```{r}

```

### Sexo

```{r}

```

### Escolaridade

```{r}

```


Column {data-height=200; data-width=250}
------

### {.no-title}

```{r}
valueBox(valueBox(format(num_obitos_2023, big.mark = "."), caption = "Numero Óbitos", color="red"), caption = "Numero Óbitos", color="red")

```

### {.no-title}

```{r}
valueBox(paste(media_idade_obitos_2023, ' anos'), caption = "Média Idade Óbitos", color="blue")

```

### {.no-title}

```{r}
valueBox('Diabetes Mellitus', caption = "Principal Fator de Risco - Óbitos", color="brown")

```

### {.no-title}

```{r}
valueBox('Dor de Garganta', caption = "Principal Sinal ou Sintoma - Óbitos", color="orange")

```

### {.no-title}

```{r}
valueBox('Masculino', caption = "Sexo", color="gray")

```

### {.no-title}

```{r}
valueBox('Superior', caption = "Escolaridade", color="gray")

```