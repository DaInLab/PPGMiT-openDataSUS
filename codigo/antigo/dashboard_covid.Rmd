---
---
title: "Dashboard Óbitos COVID-19 no Brasil"
author: "Ana Carolina Dias" 
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source_code: embed
    navbar:
      - { title: "Sobre Mim", href: "https://example.com/about", align: right }
      - { icon: fa-address-card, href: "https://example.com/about", align: right }
---

<style type="text/css">
.value-box .value {
    color: white;
}
.value-box .caption {
    color: white;
    font: 9;
}
</style>


```{r setup, include=FALSE}
#knitr::opts_chunk$set("'D:/GoogleDrive/Mestrado/PPGMiT-openDataSUS'") 

# Diretorio da Trabalho
setwd(file.path("d:", "GoogleDrive","Mestrado","PPGMiT-openDataSUS"))


# Carregando as bibliotecas necessárias
if (!("ggplot2") %in% installed.packages()) install.packages("ggplot2")   
if (!("dplyr") %in% installed.packages()) install.packages("dplyr")
if (!("readr") %in% installed.packages()) install.packages("readr")
if (!("geobr") %in% installed.packages()) install.packages("geobr")
if (!("scales") %in% installed.packages()) install.packages("scales")
if (!("ggspatial") %in% installed.packages()) install.packages("ggspatial")
if (!("kableExtra") %in% installed.packages()) install.packages("kableExtra")
if (!("knitr") %in% installed.packages()) install.packages("knitr")

library(ggplot2) # Visualizacao dos dados
library(dplyr)   # Preparacao de dados
library(readr)   # Importacao dos dados
library(geobr)   # Mapa do Brasil
library(scales)
library(ggspatial)
library(flexdashboard)
library(knitr)
library(kableExtra)

# Importacao do arquivo : covid.csv
df_covid<- read.csv('D:/GoogleDrive/Mestrado/PPGMiT-openDataSUS/dados/covid.csv', sep=";")

# Dataframe : df_covid_2021
df_covid_2021 <- df_covid %>% filter(ANO_EVOLUCA == "2021")
# Dataframe : df_covid_2022
df_covid_2022 <- df_covid %>% filter(ANO_EVOLUCA == "2022")
# Dataframe : df_covid_2023
df_covid_2023 <- df_covid %>% filter(ANO_EVOLUCA == "2023")

# Numero Notificacoes 
num_notificacoes <- as.numeric(count(df_covid))
df_notificacoes_ano <- aggregate(df_covid$ANO_NOTIFIC,by=list(df_covid$ANO_NOTIFIC), FUN=length)
df_notificacoes_ano <- setNames(df_notificacoes_ano, c("Ano", "Qtde"))

# 2021
num_notificacoes_2021 <- as.numeric(df_notificacoes_ano$Qtde[df_notificacoes_ano$Ano == '2021'])
# 2022
num_notificacoes_2022 <- as.numeric(df_notificacoes_ano$Qtde[df_notificacoes_ano$Ano == '2022'])
# 2023
num_notificacoes_2023 <- as.numeric(df_notificacoes_ano$Qtde[df_notificacoes_ano$Ano == '2023'])

# Importacao do arquivo : covid_obitos.csv
df_obitos<- read.csv('D:/GoogleDrive/Mestrado/PPGMiT-openDataSUS/dados/covid_obitos.csv', sep=";")

# Dataframe : df_obitos_2021
df_obitos_2021 <- df_obitos %>% filter(ANO_EVOLUCA == "2021")
# Dataframe : df_obitos_2022
df_obitos_2022 <- df_obitos %>% filter(ANO_EVOLUCA == "2022")
# Dataframe : df_obitos_2023
df_obitos_2023 <- df_obitos %>% filter(ANO_EVOLUCA == "2023")

# Numero Obitos
num_obitos <- as.numeric(count(df_obitos))
num_obitos_2021 <- as.numeric(count(df_obitos_2021))
num_obitos_2022 <- as.numeric(count(df_obitos_2022))
num_obitos_2023 <- as.numeric(count(df_obitos_2023))

# Media Idade Obitos
media_idade_obitos <- round(mean(df_obitos$NU_IDADE_N),1)
media_idade_obitos_2021 <- round(mean(df_obitos_2021$NU_IDADE_N),1)
media_idade_obitos_2022 <- round(mean(df_obitos_2022$NU_IDADE_N),1)
media_idade_obitos_2023 <- round(mean(df_obitos_2023$NU_IDADE_N),1)

# Sexo Obitos
df_obitos_sexo <- as.data.frame(table(df_obitos$ANO_EVOLUCA,df_obitos$CS_SEXO)) %>% arrange(desc(Var1), desc(Freq))
df_obitos_sexo <- setNames(df_obitos_sexo, c("Ano", "Sexo", "Qtde"))
df_obitos_sexo['Label'] <- ifelse(df_obitos_sexo$Sexo == "M", "Masculino",ifelse(df_obitos_sexo$Sexo == "F", "Feminino", "Indefinido" ))

# Sexo Obitos Geral
df_obitos_sexo_geral <- df_obitos_sexo %>% group_by(Label) %>% 
                        summarise(Qtde=sum(Qtde)) %>%
                        arrange(desc(Qtde))
df_obitos_sexo_geral['Percentual'] = round((df_obitos_sexo_geral$Qtde/sum(df_obitos_sexo_geral$Qtde))* 100,1)

# Sexo Obitos 2021
df_obitos_sexo_2021 <- df_obitos_sexo %>% 
  filter(Ano == '2021') %>%
  group_by(Label) %>% 
  summarise(Qtde=sum(Qtde)) %>%
  arrange(desc(Qtde))
df_obitos_sexo_2021['Percentual'] = round((df_obitos_sexo_2021$Qtde/sum(df_obitos_sexo_2021$Qtde))* 100,1)

# Sexo Obitos 2022
df_obitos_sexo_2022 <- df_obitos_sexo %>% 
  filter(Ano == '2022') %>%
  group_by(Label) %>% 
  summarise(Qtde=sum(Qtde)) %>%
  arrange(desc(Qtde))
df_obitos_sexo_2022['Percentual'] = round((df_obitos_sexo_2022$Qtde/sum(df_obitos_sexo_2022$Qtde))* 100,1)

# Sexo Obitos 2023
df_obitos_sexo_2023 <- df_obitos_sexo %>% 
  filter(Ano == '2023') %>%
  group_by(Label) %>% 
  summarise(Qtde=sum(Qtde)) %>%
  arrange(desc(Qtde))
df_obitos_sexo_2023['Percentual'] = round((df_obitos_sexo_2023$Qtde/sum(df_obitos_sexo_2023$Qtde))* 100,1)

# Escolaridade
df_obitos_escol <- as.data.frame(table(df_obitos$ANO_EVOLUCA, df_obitos$CS_ESCOL_N)) %>% arrange(desc(Var1),desc(Freq))
df_obitos_escol <- setNames(df_obitos_escol, c("Ano","Escolaridade", "Qtde"))
df_obitos_escol['Label'] <- ifelse(df_obitos_escol$Escolaridade == 0, "Sem Escolaridade",
                                  ifelse(df_obitos_escol$Escolaridade == 1, "Ensino Fundamental (1o Ciclo)", 
                                  ifelse(df_obitos_escol$Escolaridade == 2, "Ensino Fundamental (2o Ciclo)",
                                  ifelse(df_obitos_escol$Escolaridade == 3, "Ensino Médio",
                                  ifelse(df_obitos_escol$Escolaridade == 4, "Ensino Superior", "Ignorado")))))

# Escolaridade Geral
df_obitos_escol_geral <- df_obitos_escol %>% group_by(Label) %>% 
  summarise(Qtde=sum(Qtde)) %>%
  arrange(desc(Qtde))
df_obitos_escol_geral['Percentual'] <- round(df_obitos_escol_geral$Qtde / sum(df_obitos_escol_geral$Qtde) * 100,1)

# Escolaridade 2021
df_obitos_escol_2021 <- df_obitos_escol %>% 
  filter(Ano == '2021') %>%
  group_by(Label) %>% 
  summarise(Qtde=sum(Qtde)) %>%
  arrange(desc(Qtde))
df_obitos_escol_2021['Percentual'] = round((df_obitos_escol_2021$Qtde/sum(df_obitos_escol_2021$Qtde))* 100,1)

# Escolaridade 2022
df_obitos_escol_2022 <- df_obitos_escol %>% 
  filter(Ano == '2022') %>%
  group_by(Label) %>% 
  summarise(Qtde=sum(Qtde)) %>%
  arrange(desc(Qtde))
df_obitos_escol_2022['Percentual'] = round((df_obitos_escol_2022$Qtde/sum(df_obitos_escol_2022$Qtde))* 100,1)

# Escolaridade 2023
df_obitos_escol_2023 <- df_obitos_escol %>% 
  filter(Ano == '2023') %>%
  group_by(Label) %>% 
  summarise(Qtde=sum(Qtde)) %>%
  arrange(desc(Qtde))
df_obitos_escol_2023['Percentual'] = round((df_obitos_escol_2023$Qtde/sum(df_obitos_escol_2023$Qtde))* 100,1)

# Etnia (Raca/cor)
df_obitos_etnia <- as.data.frame(table(df_obitos$ANO_EVOLUCA,df_obitos$CS_RACA)) %>% arrange(desc(Var1),desc(Freq))
df_obitos_etnia <- setNames(df_obitos_etnia, c("Ano","Raca", "Qtde"))
df_obitos_etnia['Label'] <- ifelse(df_obitos_etnia$Raca == 1, "Branca",
                           ifelse(df_obitos_etnia$Raca == 2, "Preta", 
                           ifelse(df_obitos_etnia$Raca == 3, "Amarela",
                           ifelse(df_obitos_etnia$Raca == 4, "Parda",
                           ifelse(df_obitos_etnia$Raca == 5, "Indígena",
                           ifelse(df_obitos_etnia$Raca == 9, "Ignorado", "Ignorado"))))))

# Etnia Geral
df_obitos_etnia_geral <- df_obitos_etnia %>% group_by(Label) %>% 
  summarise(Qtde=sum(Qtde)) %>%
  arrange(desc(Qtde))
df_obitos_etnia_geral['Percentual'] <- round(df_obitos_etnia_geral$Qtde / sum(df_obitos_etnia_geral$Qtde) * 100,1)

# Etnia 2021
df_obitos_etnia_2021 <- df_obitos_etnia %>% 
  filter(Ano == '2021') %>%
  group_by(Label) %>% 
  summarise(Qtde=sum(Qtde)) %>%
  arrange(desc(Qtde))
df_obitos_etnia_2021['Percentual'] = round((df_obitos_etnia_2021$Qtde/sum(df_obitos_etnia_2021$Qtde))* 100,1)

# Etnia 2022
df_obitos_etnia_2022 <- df_obitos_etnia %>% 
  filter(Ano == '2022') %>%
  group_by(Label) %>% 
  summarise(Qtde=sum(Qtde)) %>%
  arrange(desc(Qtde))
df_obitos_etnia_2022['Percentual'] = round((df_obitos_etnia_2022$Qtde/sum(df_obitos_etnia_2022$Qtde))* 100,1)

# Etnia 2023
df_obitos_etnia_2023 <- df_obitos_etnia %>% 
  filter(Ano == '2023') %>%
  group_by(Label) %>% 
  summarise(Qtde=sum(Qtde)) %>%
  arrange(desc(Qtde))
df_obitos_etnia_2023['Percentual'] = round((df_obitos_etnia_2023$Qtde/sum(df_obitos_etnia_2023$Qtde))* 100,1)

```

Visão Geral
===

Column {data-height=200; data-width=180}
------

### Numero Notificações COVID-19 {.no-title}

```{r}
valueBox(format(num_notificacoes, big.mark = ".") , caption = "Notificações COVID-19", color="black")
```


### Numero Notificações COVID-19 {.no-title}

```{r}
df_notificacoes_ano %>%
  kable("html", escape = F) %>%
  kable_styling("striped", full_width = F)
```


Column {data-height=200; data-width=250}
------

### {.no-title}

```{r}
valueBox(format(num_obitos, big.mark = "."), caption = "Óbitos", color="red")

```

### {.no-title}

```{r}
valueBox(paste(media_idade_obitos, ' anos'), caption = "Média Idade", color="gray")

```

### {.no-title}

```{r}
valueBox(paste(df_obitos_sexo_geral$Label[1],' - ', format(df_obitos_sexo_geral$Percentual[1]), '%'), caption = "Sexo", color="blue")

```

### {.no-title}

```{r}
valueBox(paste(df_obitos_escol_geral$Label[1],' - ', format(df_obitos_escol_geral$Percentual[1]), '%'), caption = "Escolaridade", color="green")

```

### {.no-title}

```{r}
valueBox(paste(df_obitos_etnia$Label[1], ' - ', format(df_obitos_etnia$Percentual[1]), '%'), caption = "Etnia", color="orange")

```


2021
===

Column {data-height=200; data-width=180}
------

### Numero Notificações {.no-title}

```{r}
valueBox(format(num_notificacoes_2021, big.mark = ".") , caption = "Notificações COVID-19", color="black")

```


### Obitos {.no-title}

```{r}
gauge(55, min = 0, max = 100, symbol = '%', label="Obitos %", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Óbitos Outras Doenças {.no-title}

```{r}
gauge(13, min = 0, max = 100, symbol = '%', label="Óbitos Outras Doenças",gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Cura {.no-title}

```{r}
gauge(30, min = 0, max = 100, symbol = '%', label="Cura %", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```


### Sem Informação {.no-title}

```{r}
gauge(2, min = 0, max = 100, symbol = '%', label= "Sem Informação", gaugeSectors(
  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

Column {.tabset}
---
### Mapa Óbitos Brasil

```{r}

```

### Fatores de Risco 

```{r}

```

### Sinais e Sintomas

```{r}

```

### Idade

```{r}

```

### Sexo

```{r}

```

### Escolaridade

```{r}

```


Column {data-height=200; data-width=250}
------

### {.no-title}

```{r}
valueBox(format(num_obitos_2021, big.mark = "."), caption = "Óbitos", color="red")

```
### {.no-title}

```{r}
valueBox(paste(media_idade_obitos_2021, ' anos'), caption = "Média Idade", color="gray")

```

### {.no-title}

```{r}
valueBox(paste(df_obitos_sexo_2021$Label[1],' - ', format(df_obitos_sexo_2021$Percentual[1]), '%'), caption = "Sexo", color="blue")

```
### {.no-title}

```{r}
valueBox(paste(df_obitos_escol_2021$Label[1],' - ', format(df_obitos_escol_2021$Percentual[1]), '%'), caption = "Escolaridade", color="green")

```

### {.no-title}

```{r}
valueBox('--', caption = "Principal Fator de Risco - Óbitos", color="brown")

```


### {.no-title}

```{r}
valueBox('--', caption = "Principal Sinal ou Sintoma - Óbitos", color="orange")

```


2022
===

Column {data-height=200; data-width=180}
------

### Numero Notificações {.no-title}

```{r}
valueBox(format(num_notificacoes_2022, big.mark = ".") , caption = "Notificações COVID-19", color="black")

```


### Obitos {.no-title}

```{r}
#gauge(55, min = 0, max = 100, symbol = '%', label="Obitos %", gaugeSectors(
 # success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Óbitos Outras Doenças {.no-title}

```{r}
#gauge(13, min = 0, max = 100, symbol = '%', label="Óbitos Outras Doenças",gaugeSectors(
 # success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Cura {.no-title}

```{r}
#gauge(30, min = 0, max = 100, symbol = '%', label="Cura %", gaugeSectors(
 # success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```


### Sem Informação {.no-title}

```{r}
#gauge(2, min = 0, max = 100, symbol = '%', label= "Sem Informação", gaugeSectors(
 # success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

Column {.tabset}
---
### Mapa Óbitos Brasil

```{r}

```

### Fatores de Risco 

```{r}

```

### Sinais e Sintomas

```{r}

```

### Idade

```{r}

```

### Sexo

```{r}

```

### Escolaridade

```{r}

```


Column {data-height=200; data-width=250}
------

### {.no-title}

```{r}
valueBox(valueBox(format(num_obitos_2022, big.mark = "."), caption = "Óbitos", color="red"), caption = "Numero Óbitos", color="red")

```

### {.no-title}

```{r}
valueBox(paste(media_idade_obitos_2022, ' anos'), caption = "Média Idade", color="gray")

```
### {.no-title}

```{r}
valueBox(paste(df_obitos_sexo_2022$Label[1],' - ', format(df_obitos_sexo_2022$Percentual[1]), '%'), caption = "Sexo", color="blue")

```

### {.no-title}

```{r}
valueBox(paste(df_obitos_escol_2022$Label[1],' - ', format(df_obitos_escol_2022$Percentual[1]), '%'), caption = "Escolaridade", color="green")

```

### {.no-title}

```{r}
valueBox('--', caption = "Principal Fator de Risco - Óbitos", color="brown")

```

### {.no-title}

```{r}
valueBox('--', caption = "Principal Sinal ou Sintoma - Óbitos", color="orange")

```


2023
===

Column {data-height=200; data-width=180}
------

### Numero Notificações {.no-title}

```{r}
valueBox(format(num_notificacoes_2023, big.mark = ".") , caption = "Notificações COVID-19", color="black")

```

### Obitos {.no-title}

```{r}
#gauge(55, min = 0, max = 100, symbol = '%', label="Obitos %", gaugeSectors(
#  success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Óbitos Outras Doenças {.no-title}

```{r}
#gauge(13, min = 0, max = 100, symbol = '%', label="Óbitos Outras Doenças",gaugeSectors(
 # success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

### Cura {.no-title}

```{r}
#gauge(30, min = 0, max = 100, symbol = '%', label="Cura %", gaugeSectors(
 # success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```


### Sem Informação {.no-title}

```{r}
#gauge(2, min = 0, max = 100, symbol = '%', label= "Sem Informação", gaugeSectors(
 # success = c(0, 39), warning = c(40, 79), danger = c(80, 100)))

```

Column {.tabset}
---
### Mapa Óbitos Brasil

```{r}

```

### Fatores de Risco 

```{r}

```

### Sinais e Sintomas

```{r}

```

### Idade

```{r}

```

### Sexo

```{r}

```

### Escolaridade

```{r}

```


Column {data-height=200; data-width=250}
------

### {.no-title}

```{r}
valueBox(valueBox(format(num_obitos_2023, big.mark = "."), caption = "Óbitos", color="red"), caption = "Numero Óbitos", color="red")

```

### {.no-title}

```{r}
valueBox(paste(media_idade_obitos_2023, ' anos'), caption = "Média Idade", color="gray")

```

### {.no-title}

```{r}
valueBox(paste(df_obitos_sexo_2023$Label[1],' - ', format(df_obitos_sexo_2023$Percentual[1]), '%'), caption = "Sexo", color="blue")

```
### {.no-title}

```{r}
valueBox(paste(df_obitos_escol_2023$Label[1],' - ', format(df_obitos_escol_2023$Percentual[1]), '%'), caption = "Escolaridade", color="green")

```

### {.no-title}

```{r}
valueBox('--', caption = "Principal Sinal ou Sintoma - Óbitos", color="orange")

```

